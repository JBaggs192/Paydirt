<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Baggaley Football League</title>

  <style>
    body {
      background: #20252b;
      margin: 0;
      font-family: Arial, sans-serif;
      color: white;
    }

    #game-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 16px;
    }
/*
    #league-title {
      font-size: 38px;
      font-weight: bold;
      letter-spacing: 1.5px;
      margin-bottom: 14px;
      text-align: center;
    }
*/

    /* ===========================
       SCOREBOARD (REVAMPED LAYOUT)
       =========================== */

    #scoreboard {
      --sb-top-h: 120px;
      --sb-bottom-h: 64px;
      --sb-divider: 3px;
      --sb-clock-w: 200px;

      position: relative;
      display: flex;

      width: calc(1000px + 0px);
      max-width: calc(100vw - 40px);
      height: calc(var(--sb-top-h) + var(--sb-bottom-h));

      margin-bottom: 2px;
      border: 3px solid white;
      border-radius: 14px;
      background: rgba(0, 0, 0, 0.35);
      box-shadow: 0 0 18px rgba(0,0,0,0.6);
      overflow: hidden;
    }

    /* Horizontal divider between top and bottom */
    #scoreboard::after {
      content: "";
      position: absolute;
      left: 0;
      right: 0;
      top: var(--sb-top-h);
      height: var(--sb-divider);
      background: rgba(255,255,255,0.95);
      z-index: 6;
      pointer-events: none;
    }

    /* Teams sit left and right in the TOP row via flex;
       bottom row is positioned absolutely (so no top-row overlap, no weird lines). */
    .team {
      flex: 1 1 0;
      min-width: 0;
      display: flex;
      flex-direction: column;
    }

    .team-top {
      height: var(--sb-top-h);
      display: flex;
      align-items: center;
      justify-content: space-between;

      padding: 10px 18px;
      box-sizing: border-box;
      background: rgba(255,255,255,0.02);
    }

    /* Bottom row boxes (positioned relative to #scoreboard to keep them inside the .team for your JS) */
    .team-bottom {
      position: absolute;
      bottom: 0;
      height: var(--sb-bottom-h);
      width: calc(50% - (var(--sb-clock-w) / 2));

      display: flex;
      align-items: center;
      justify-content: center;

      padding: 10px 12px;
      box-sizing: border-box;
      background: rgba(255,255,255,0.02);
      z-index: 3;
    }

    .team1 .team-bottom { left: 0; }
    .team2 .team-bottom { right: 0; }

    /* Center divider (TOP ONLY) */
    #scoreboard-center-divider {
      position: absolute;
      left: 50%;
      top: 0;
      height: var(--sb-top-h);
      width: 0;
      z-index: 7;
      pointer-events: none;
    }

    #scoreboard-center-divider::before {
      content: "";
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: var(--sb-divider);
      transform: translateX(-50%);
      background: rgba(255,255,255,0.95);
    }

    /* Team top area gets a color wash that fades toward center */
.team-top {
  position: relative;
  overflow: hidden;

  /* Replace your current background line with this (keeps your subtle dark base) */
  background: rgba(255,255,255,0.02);
}

/* Put content above the gradient overlay */
.team-top > * {
  position: relative;
  z-index: 2;
}

/* Gradient overlay */
.team-top::before {
  content: "";
  position: absolute;
  inset: 0;
  z-index: 1;
  pointer-events: none;

  /* Default (overridden by team1/team2 direction rules below) */
  background: linear-gradient(
    90deg,
    rgba(var(--team-bg-rgb, 255,255,255), 0.45) 0%,
    rgba(var(--team-bg-rgb, 255,255,255), 0.12) 45%,
    rgba(0,0,0,0.00) 78%
  );
}

/* Left team fades left -> center */
.team1 .team-top::before {
  background: linear-gradient(
    90deg,
    rgba(var(--team-bg-rgb, 255,255,255), 0.50) 0%,
    rgba(var(--team-bg-rgb, 255,255,255), 0.16) 48%,
    rgba(0,0,0,0.00) 80%
  );
}

/* Right team fades right -> center */
.team2 .team-top::before {
  background: linear-gradient(
    270deg,
    rgba(var(--team-bg-rgb, 255,255,255), 0.50) 0%,
    rgba(var(--team-bg-rgb, 255,255,255), 0.16) 48%,
    rgba(0,0,0,0.00) 80%
  );
}


    /* PLAY CLOCK (BOTTOM CENTER) */
    #play-clock-container {
      position: absolute;
      left: 50%;
      bottom: 0;
      transform: translateX(-50%);

      width: var(--sb-clock-w);
      height: var(--sb-bottom-h);

      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;

      border-left: var(--sb-divider) solid rgba(255,255,255,0.95);
      border-right: var(--sb-divider) solid rgba(255,255,255,0.95);

      background: rgba(255,255,255,0.02);
      box-sizing: border-box;
      z-index: 5;
    }

    /* Team logo & score sizing for the new layout */
    .team-logo {
      height: 100px;
      display: none;
      flex: 0 0 auto;
    }

    .score {
      background: none;
      border: none;
      color: white;
      font-size: 86px;
      font-weight: bold;
      text-align: center;
      width: 140px;
      margin: 0;
      padding: 0;
      outline: none;
      flex: 0 0 auto;
    }

    .clock-label {
      font-size: 12px;
      letter-spacing: 1px;
      opacity: 0.75;
      margin-bottom: 4px;
      text-transform: uppercase;
    }

    .clock-controls {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    #play-clock-value {
      font-size: 30px;
      font-weight: bold;
      min-width: 72px;
      text-align: center;
    }

    .clock-controls button {
      background: #2a2f36;
      border: 1px solid #444;
      color: white;
      font-size: 20px;
      padding: 2px 10px;
      cursor: pointer;
    }

    .clock-controls button:hover {
      background: #3a4048;
    }

    /* ===========================
       POSSESSION GLOW (ADAPTED)
       =========================== */

    .team {
      position: relative;
      border-radius: 14px;
      transition: box-shadow 0.3s ease;
    }

    .team.possession .team-top {
      box-shadow:
        0 0 20px rgba(255,255,255,0.25),
        0 0 35px var(--team-glow);
      border-radius: 12px;
    }

    /* ===========================
       DOWN & DISTANCE (BOTTOM ROW)
       =========================== */

    .team-down {
      font-size: 26px;
      font-weight: bold;
      opacity: 0;
      color:#e6be00;
      transition: opacity 0.25s ease;
    }

    .team.possession .team-down {
      opacity: 1;
    }

    .team-select {
      background: transparent;
      border: none;
      color: white;
      font-size: 30px;
      font-weight: bold;
      text-align: center;
      cursor: pointer;
      appearance: none;
    }

    .team-select option {
      background-color: #20252b;
      color: white;
    }

    canvas {
      border: 4px solid white;
      box-shadow: 0 0 20px rgba(0,0,0,0.7);
      background: #0b5c1b;
    }

    #reset-hint {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      margin-top: 6px;
    }

    #resetFirstDownBtn {
      background: linear-gradient(180deg, #ffd400, #e6be00);
      border: none;
      color: #1a1a1a;
      font-size: 16px;
      font-weight: bold;
      padding: 10px 22px;
      border-radius: 999px;
      cursor: pointer;
      box-shadow:
        0 4px 10px rgba(0,0,0,0.4),
        inset 0 -2px 0 rgba(0,0,0,0.25);
      transition: transform 0.08s ease, box-shadow 0.08s ease;
    }

    #resetFirstDownBtn:hover {
      transform: translateY(-1px);
      box-shadow:
        0 6px 14px rgba(0,0,0,0.45),
        inset 0 -2px 0 rgba(0,0,0,0.25);
    }

    #resetFirstDownBtn:active {
      transform: translateY(1px);
      box-shadow:
        0 2px 6px rgba(0,0,0,0.4),
        inset 0 2px 0 rgba(0,0,0,0.25);
    }

    .reset-subtext {
      font-size: 13px;
      color: rgba(255,255,255,0.75);
      letter-spacing: 0.5px;
    }

    .reset-subtext .key {
      display: inline-block;
      padding: 2px 6px;
      margin: 0 2px;
      border-radius: 4px;
      background: rgba(255,255,255,0.15);
      border: 1px solid rgba(255,255,255,0.35);
      font-weight: bold;
    }

    /* ===========================
       CONTROLS PANEL
       =========================== */
    #controls-panel {
      position: absolute;
      left: 20px;
      top: 140px;
      width: 190px;
      padding: 14px 16px;
      border-radius: 14px;
      background: rgba(0, 0, 0, 0.45);
      border: 2px solid rgba(255,255,255,0.4);
      box-shadow: 0 0 18px rgba(0,0,0,0.6);
      color: white;
      font-family: Arial, sans-serif;
    }

    .controls-title {
      font-size: 18px;
      font-weight: bold;
      letter-spacing: 1px;
      margin-bottom: 10px;
      text-transform: uppercase;
      opacity: 0.9;
    }

    .control-row {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
      gap: 10px;
    }

    .control-row:last-child {
      margin-bottom: 0;
    }

    .key {
      min-width: 60px;
      text-align: center;
      padding: 6px 8px;
      border-radius: 8px;
      background: rgba(255,255,255,0.15);
      border: 1px solid rgba(255,255,255,0.5);
      font-weight: bold;
      font-size: 14px;
      box-shadow: inset 0 -2px 0 rgba(0,0,0,0.25);
    }

    .desc {
      font-size: 14px;
      opacity: 0.9;
    }

    /* ===========================
       DICE PANEL
       =========================== */
    #dice-panel {
      position: absolute;
      right: 20px;
      top: 140px;
      width: 240px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .dice-box {
      background: rgba(0,0,0,0.45);
      border: 2px solid rgba(255,255,255,0.4);
      border-radius: 2px;
      padding: 12px;
      box-shadow: 0 0 18px rgba(0,0,0,0.6);
    }

    .dice-title {
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }

    .dice-list {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
    }

    .die {
  flex: 0 0 44px;
  height: 44px;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 8px;
  font-weight: bold;
  border: 2px solid white;
  font-size: 18px;
    }

    .die {
      box-shadow:
        inset 0 -2px 0 rgba(0,0,0,0.25),
        0 3px 6px rgba(0,0,0,0.4);
    }


    /* Dice colors */
    .die.black { background:#000; color:white; }
    .die.yellow { background:#FFD400; color:#000; }
    .die.white { background:#FFF; color:#000; }
    .die.green { background:#1e7f3f; color:white; }
    .die.red { background:#b0122a; color:white; }

    .dice-result {
      text-align: center;
      font-size: 16px;
      font-weight: bold;
    }

    .die {
      position: relative;
      overflow: hidden;
    }

    .die.rolling {
      animation: rollFlash 0.6s linear;
    }

    @keyframes rollFlash {
      0%   { filter: brightness(1); transform: scale(1); }
      25%  { filter: brightness(1.6); transform: scale(1.1); }
      50%  { filter: brightness(0.8); transform: scale(0.95); }
      75%  { filter: brightness(1.4); transform: scale(1.05); }
      100% { filter: brightness(1); transform: scale(1); }
    }

    .die span {
      font-size: 18px;
    }

    .die.rolling {
  animation: rollSpin 0.6s linear infinite;
}

@keyframes rollSpin {
  0%   { transform: rotate(0deg) scale(1); }
  25%  { transform: rotate(90deg) scale(1.08); }
  50%  { transform: rotate(180deg) scale(0.95); }
  75%  { transform: rotate(270deg) scale(1.05); }
  100% { transform: rotate(360deg) scale(1); }
}

.die.settle {
  animation: diceSettle 0.18s ease-out;
}

@keyframes diceSettle {
  0%   { transform: scale(1.15); }
  100% { transform: scale(1); }
}

/* Prevent grid from stretching offense dice */
.dice-box.offense .die {
  width: 66px;
}

/* === OFFENSE DICE: LARGE, TIGHT, NO OVERLAP === */
.dice-box.offense .dice-list {
  grid-template-columns: repeat(2, max-content);
  gap: 6px 8px;               /* tight but safe */
  justify-content: center;
  margin-top: 8px;
}

/* Large square dice */
.dice-box.offense .die {
  width: 84px;
  height: 84px;
  font-size: 28px;
}

/* Bring top dice closer together horizontally */
.dice-box.offense .dice-list .die:nth-child(1) {
  margin-right: -6px;
}

.dice-box.offense .dice-list .die:nth-child(2) {
  margin-left: -6px;
}

/* Bottom die: TOUCHING, NOT OVERLAPPING */
.dice-box.offense .dice-list .die:nth-child(3) {
  margin-top: -8px;           /* key change */
}

.dice-box .die span {
  font-size: 50px;
}

/* Center and tighten DEFENSE dice row */
.dice-box.defense .dice-list {
  justify-content: center;
  width: fit-content;
  margin: 0 auto 10px;
}

/* Pull top offense dice together by collapsing grid gap */
.dice-box.offense .dice-list {
  column-gap: 2px;   /* almost touching */
}


/*===================
   DICE PIPS (ADD ONLY)
   ===========================
.pips {
  position: relative;
  width: 100%;
  height: 100%;
}

.pip {
  position: absolute;
  width: 7px;
  height: 7px;
  border-radius: 50%;
  background: currentColor;
}

/* Pip positions
.pip.tl { top: 8px; left: 8px; }
.pip.tr { top: 8px; right: 8px; }
.pip.bl { bottom: 8px; left: 8px; }
.pip.br { bottom: 8px; right: 8px; }
.pip.ml { top: 50%; left: 8px; transform: translateY(-50%); }
.pip.mr { top: 50%; right: 8px; transform: translateY(-50%); }
.pip.c  { top: 50%; left: 50%; transform: translate(-50%, -50%); }
*/

    /* ===========================
       STATUS BAR
       =========================== */

    #status-bar {
      display: flex;
      justify-content: center;
      width: 100%;
      margin-bottom: 18px;
    }

    .status-inner {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .team-header {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #controls-panel .team-select {
      background: rgba(255, 255, 255, 0.15);
      color: white;
      border: 1px solid rgba(255,255,255,0.5);
      border-radius: 8px;
      padding: 6px 8px;
      font-size: 11.5px;
      appearance: auto;
    }

    #controls-panel .team-select option {
      background: #20252b;
      color: white;
    }

    /* DICE PANEL */

    #dice-panel {
      width: 290px;
      gap: 20px;
    }

    .dice-box {
      padding: 2px;
      background: rgba(0,0,0,0.55);
      border: 2px solid rgba(255,255,255,0.55);
      box-shadow: 0 0 22px rgba(0,0,0,0.75);
    }

    .dice-title {
      font-size: 16px;
      text-align: center;
      margin-bottom: 12px;
    }

    .die {
      flex: 0 0 66px;
      height: 66px;
      border-radius: 10px;
      font-size: 24px;
    }

    .die span {
      font-size: 24px;
    }

    /* OFFENSE ONLY: 2 on top, 1 centered below (no HTML changes) */
    .dice-box.offense .dice-list {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      justify-items: center;
      gap: 14px;
      margin-bottom: 12px;
    }

    .dice-box.offense .dice-list .die:nth-child(3) {
      grid-column: 1 / -1;
    }

  </style>

</head>
<body>
  <div id="game-container">

  <!-- ===========================
       SCOREBOARD
       =========================== -->
  <div id="scoreboard">

    <!-- TEAM 1 -->
    <div class="team team1">
      <div class="team-top">
        <img class="team-logo" id="team1Logo" />
        <input type="number" id="score1" class="score" value="0">
      </div>

      <div class="team-bottom">
        <div class="team-down" id="team1Down">
          <span class="down-text">1st</span> &amp;
          <span class="distance-text">10</span>
        </div>
      </div>
    </div>

    <!-- TOP CENTER DIVIDER -->
    <div id="scoreboard-center-divider" aria-hidden="true"></div>

    <!-- PLAY CLOCK (BOTTOM CENTER) -->
    <div id="play-clock-container">
      <div class="clock-label">PLAY CLOCK</div>

      <div class="clock-controls">
        <button onclick="updatePlayClock(-0.5)">−</button>
        <div id="play-clock-value">25.0</div>
        <button onclick="updatePlayClock(0.5)">+</button>
      </div>
    </div>

    <!-- TEAM 2 -->
    <div class="team team2">
      <div class="team-top">
        <input type="number" id="score2" class="score" value="0">
        <img class="team-logo" id="team2Logo" />
      </div>

      <div class="team-bottom">
        <div class="team-down" id="team2Down">
          <span class="down-text">1st</span> &amp;
          <span class="distance-text">10</span>
        </div>
      </div>
    </div>

  </div>

  <!-- ===========================
       MAIN PLAY AREA (FIELD + DICE)
       =========================== -->
  <div id="main-play-area">

    <!-- Removed floating 1st & 10 box and Possession team box -->
    <div id="status-bar" style="display:none;"></div>

    <!-- FIELD -->
    <div id="field-wrapper">
      <canvas id="field" width="1000" height="400"></canvas>
    </div>

<!-- ===========================
     DICE PANEL
     =========================== -->
<div id="dice-panel">

  <!-- OFFENSE -->
  <div class="dice-box offense">
    <div class="dice-title">Offense</div>

    <div class="dice-list">
      <div class="die black"><span id="offBlack">–</span></div>
      <div class="die yellow"><span id="offYellow">–</span></div>
      <div class="die white"><span id="offWhite">–</span></div>
    </div>

    <div class="dice-result">
      Total: <span id="offenseResult">—</span>
    </div>
  </div>

  <!-- DEFENSE -->
  <div class="dice-box defense">
    <div class="dice-title">Defense</div>

    <div class="dice-list">
      <div class="die green"><span id="defGreen">–</span></div>
      <div class="die red"><span id="defRed">–</span></div>
    </div>

    <div class="dice-result">
      Total: <span id="defenseResult">—</span>
    </div>
  </div>

</div>

  <!-- ===========================
       CONTROLS + TEAM SELECTORS
       =========================== -->
  <div id="controls-panel">
    <div class="controls-title">Controls</div>

    <div class="control-row">
      <div class="key-group">
        <span class="key">←</span>
        <span class="key">→</span>
      </div>
      <span class="desc">Move Ball</span>
    </div>

    <div class="control-row">
      <span class="key">↑</span>
      <span class="desc">Set 1st &amp; 10</span>
    </div>

    <div class="control-row">
      <span class="key">Space</span>
      <span class="desc">Advance Down</span>
    </div>

    <div class="control-row">
      <span class="key">Enter</span>
      <span class="desc">Switch Possession</span>
    </div>

    <div class="control-row">
      <span class="key">O</span>
      <span class="desc">Roll for Offense</span>
    </div>

    <div class="control-row">
      <span class="key">D</span>
      <span class="desc">Roll for Defense</span>
    </div>

    <hr style="margin: 14px 0; opacity: 0.3;">

<div class="controls-title">Team Select</div>

<div class="control-row">
  <select id="team1" class="team-select">
  </select>
</div>

<div class="control-row">
  <select id="team2" class="team-select">
  </select>
</div>

<script>

/* ===========================
   TEAM COLORS and logos
   =========================== */
const TEAM_COLORS = {
  "Arizona Cardinals": {
    bg:"#000000", text:"#97233F", outline:"#FFFFFF",
    logo:"team_logos/Arizona_Cardinals_logo.svg.png"
  },
  "Atlanta Falcons": {
    bg:"#000000", text:"#A71930", outline:"#C7C9CB",
    logo:"team_logos/Atlanta_Falcons_logo.svg.png"
  },
  "Baltimore Ravens": {
    bg:"#000000", text:"#241773", outline:"#9E7C0C",
    logo:"team_logos/Baltimore_Ravens_logo.svg.png"
  },
  "Buffalo Bills": {
    bg:"#00338D", text:"#C60C30", outline:"#FFFFFF",
    logo:"team_logos/Buffalo_Bills_logo.svg.png"
  },
  "Carolina Panthers": {
    bg:"#000000", text:"#0085CA", outline:"#BFC0BF",
    logo:"team_logos/Carolina_Panthers_logo.svg.png"
  },
  "Chicago Bears": {
    bg:"#0B162A", text:"#C83803", outline:"#FFFFFF",
    logo:"team_logos/Chicago_Bears_logo_primary.svg.png"
  },
  "Cincinnati Bengals": {
    bg:"#000000", text:"#FB4F14", outline:"#FFFFFF",
    logo:"team_logos/Cincinnati_Bengals_logo.svg.png"
  },
  "Cleveland Browns": {
    bg:"#311D00", text:"#FF3C00", outline:"#FFFFFF",
    logo:"team_logos/Cleveland_Browns_logo.svg.png"
  },
  "Dallas Cowboys": {
    bg:"#002244", text:"#869397", outline:"#FFFFFF",
    logo:"team_logos/Dallas_Cowboys.svg.png"
  },
  "Denver Broncos": {
    bg:"#002244", text:"#FB4F14", outline:"#FFFFFF",
    logo:"team_logos/Denver_Broncos_logo.svg.png"
  },
  "Detroit Lions": {
    bg:"#0076B6", text:"#B0B7BC", outline:"#000000",
    logo:"team_logos/Detroit_Lions_logo.svg.png"
  },
  "Green Bay Packers": {
    bg:"#203731", text:"#FFB612", outline:"#FFFFFF",
    logo:"team_logos/Green_Bay_Packers_logo.svg.png"
  },
  "Houston Texans": {
    bg:"#021018", text:"#A71930", outline:"#FFFFFF",
    logo:"team_logos/Houston_Texans_logo.svg.png"
  },
  "Indianapolis Colts": {
    bg:"#002C5F", text:"#FFFFFF", outline:"#A5ACAF",
    logo:"team_logos/Indianapolis_Colts_logo.svg.png"
  },
  "Jacksonville Jaguars": {
    bg:"#000000", text:"#006778", outline:"#D7A22A",
    logo:"team_logos/Jacksonville_Jaguars_logo.svg.png"
  },
  "Kansas City Chiefs": {
    bg:"#B0122A", text:"#FFB81C", outline:"#FFFFFF",
    logo:"team_logos/Kansas_City_Chiefs_logo.svg.png"
  },
  "Las Vegas Raiders": {
    bg:"#000000", text:"#A5ACAF", outline:"#FFFFFF",
    logo:"team_logos/Las_Vegas_Raiders_logo.svg.png"
  },
  "Los Angeles Chargers": {
    bg:"#0080C6", text:"#FFC20E", outline:"#FFFFFF",
    logo:"team_logos/Los_Angeles_Chargers_logo.svg.png"
  },
  "Los Angeles Rams": {
    bg:"#003594", text:"#FFA300", outline:"#FFFFFF",
    logo:"team_logos/Los_Angeles_Rams_logo.svg.png"
  },
  "Miami Dolphins": {
    bg:"#008E97", text:"#FC4C02", outline:"#FFFFFF",
    logo:"team_logos/Miami_Dolphins_logo.svg.png"
  },
  "Minnesota Vikings": {
    bg:"#4F2683", text:"#FFC62F", outline:"#FFFFFF",
    logo:"team_logos/Minnesota_Vikings_logo.svg.png"
  },
  "New England Patriots": {
    bg:"#002244", text:"#C60C30", outline:"#B0B7BC",
    logo:"team_logos/New_England_Patriots_logo.svg.png"
  },
  "New Orleans Saints": {
    bg:"#000000", text:"#D3BC8D", outline:"#FFFFFF",
    logo:"team_logos/New_Orleans_Saints_logo.svg.png"
  },
  "New York Giants": {
    bg:"#0B2265", text:"#A71930", outline:"#FFFFFF",
    logo:"team_logos/New_York_Giants_logo.svg.png"
  },
  "New York Jets": {
    bg:"#115740", text:"#FFFFFF", outline:"#000000",
    logo:"team_logos/New_York_Jets_logo.svg.png"
  },
  "Philadelphia Eagles": {
    bg:"#004851", text:"#A5ACAF", outline:"#000000",
    logo:"team_logos/Philadelphia_Eagles_logo.svg.png"
  },
  "Pittsburgh Steelers": {
    bg:"#000000", text:"#FFB612", outline:"#FFFFFF",
    logo:"team_logos/Pittsburgh_Steelers_logo.svg.png"
  },
  "San Francisco 49ers": {
    bg:"#AA0000", text:"#B3995D", outline:"#FFFFFF",
    logo:"team_logos/San_Francisco_49ers_logo.svg.png"
  },
  "Seattle Seahawks": {
    bg:"#002244", text:"#69BE28", outline:"#A5ACAF",
    logo:"team_logos/Seattle_Seahawks_logo.svg.png"
  },
  "Tampa Bay Buccaneers": {
    bg:"#A71930", text:"#34302B", outline:"#FFFFFF",
    logo:"team_logos/Tampa_Bay_Buccaneers_logo.svg.png"
  },
  "Tennessee Titans": {
    bg:"#002244", text:"#4B92DB", outline:"#C60C30",
    logo:"team_logos/Tennessee_Titans_logo.svg.png"
  },
  "Washington Commanders": {
    bg:"#5A1414", text:"#FFB612", outline:"#000000",
    logo:"team_logos/Washington_Commanders_logo.svg.png"
  }
};

/* ===========================
   CANVAS SETUP
   =========================== */
const canvas = document.getElementById("field");
const ctx = canvas.getContext("2d");

const W = canvas.width;
const H = canvas.height;

/* Keep existing IDs for down/distance; use the first (team1Down). */
function getDownDistanceEls() {
  const teamEl = document.querySelector(".team.possession");
  if (!teamEl) return {};
  return {
    down: teamEl.querySelector(".down-text"),
    distance: teamEl.querySelector(".distance-text")
  };
}

const TOTAL_YARDS = 120;
const ENDZONE = 10;
const PLAY_START = ENDZONE;
const PLAY_END = TOTAL_YARDS - ENDZONE;
const P = W / TOTAL_YARDS;

const MIDFIELD_YARD = 60;
const LOGO_WIDTH_YARDS = 10;

const LEFT_GOAL_LINE = 10;
const RIGHT_GOAL_LINE = 110;

const footballImg = new Image();
footballImg.src = "football_clean.png";

const bflLogo = new Image();
bflLogo.src = "BFL_logo.png";

let ballYard = 35;
let firstDownYard = null;
let possession = "team1";
let down = 1;
let toGo = 10;
let lineOfScrimmageYard = null;

let playClock = 25.0;

/* ===========================
   HELPERS
   =========================== */
const xOf = yard => yard * P;
const getMascot = team => team ? team.split(" ").pop().toUpperCase() : "";

function getDownLabel(d) {
  if (d === 1) return "1st";
  if (d === 2) return "2nd";
  if (d === 3) return "3rd";
  return "4th";
}

function getGoalLineYard() {
  return possession === "team1" ? RIGHT_GOAL_LINE : LEFT_GOAL_LINE;
}

function getDownDistanceEls() {
  const teamEl = document.querySelector(".team.possession");
  if (!teamEl) return {};

  return {
    down: teamEl.querySelector(".down-text"),
    distance: teamEl.querySelector(".distance-text")
  };
}

function recalculateDownAndDistance() {
  if (firstDownYard === null) return;

  const { down: downEl, distance: distanceEl } = getDownDistanceEls();
  if (!downEl || !distanceEl) return;

  const goalLine = getGoalLineYard();

  // 1st and goal logic
  if (
    (possession === "team1" && firstDownYard >= goalLine) ||
    (possession === "team2" && firstDownYard <= goalLine)
  ) {
    distanceEl.textContent = "Goal";
  } else {
    let yardsRemaining =
      possession === "team1"
        ? Math.round(firstDownYard - ballYard)
        : Math.round(ballYard - firstDownYard);

    distanceEl.textContent = Math.max(0, yardsRemaining);
  }

  downEl.textContent = getDownLabel(down);
}

function hexToRgbTriplet(hex) {
  if (!hex) return "255,255,255";
  let h = hex.replace("#", "").trim();
  if (h.length === 3) h = h.split("").map(c => c + c).join("");
  if (h.length !== 6) return "255,255,255";
  const n = parseInt(h, 16);
  const r = (n >> 16) & 255;
  const g = (n >> 8) & 255;
  const b = n & 255;
  return `${r},${g},${b}`;
}


function updateTeamLogo(teamKey) {
  const select = teamKey === "team1" ? team1 : team2;
  const logoEl = document.getElementById(
    teamKey === "team1" ? "team1Logo" : "team2Logo"
  );

  const teamName = select.value;
  const logoPath = TEAM_COLORS[teamName]?.logo;
  const teamEl = document.querySelector(teamKey === "team1" ? ".team1" : ".team2");
    // Set team header gradient color to match endzone color (black -> use text/outline instead)
  const colors = TEAM_COLORS[teamName] || {};
  const rawHex = (colors.bg || "").toUpperCase();

  const isBlack =
    rawHex === "#000000" ||
    rawHex === "#000" ||
    rawHex === "BLACK";

  const gradientHex = isBlack
    ? (colors.text || colors.outline || "#FFFFFF")
    : (colors.bg || colors.text || colors.outline || "#FFFFFF");

  if (teamEl) teamEl.style.setProperty("--team-bg-rgb", hexToRgbTriplet(gradientHex));


  if (!logoPath) return;

  logoEl.src = logoPath;
  logoEl.style.display = "block";
}

team1.onchange = () => {
  updateTeamLogo("team1");
  drawField();
};

team2.onchange = () => {
  updateTeamLogo("team2");
  drawField();
};

/*PLAY CLOCK FUNCTION*/
function updatePlayClock(delta) {
  playClock = Math.max(0, playClock + delta);
  document.getElementById("play-clock-value").textContent =
    playClock.toFixed(1);
}



/* ===========================
   FIELD DRAWING
   =========================== */
function drawBackground() {
  const g = ctx.createLinearGradient(0, 0, 0, H);
  g.addColorStop(0, "#166b24");
  g.addColorStop(0.5, "#0b5c1b");
  g.addColorStop(1, "#166b24");
  ctx.fillStyle = g;
  ctx.fillRect(0, 0, W, H);

  for (let y = PLAY_START; y < PLAY_END; y += 5) {
    if (((y - PLAY_START) / 5) % 2 === 0) continue;
    ctx.fillStyle = "rgba(255,255,255,0.06)";
    ctx.fillRect(xOf(y), 0, 5 * P, H);
  }
}

function drawMidfieldLogo() {
  if (!bflLogo.complete || !bflLogo.naturalWidth) return;

  const logoW = LOGO_WIDTH_YARDS * P;
  const aspect = bflLogo.naturalHeight / bflLogo.naturalWidth;
  const logoH = logoW * aspect;

  const x = Math.round(xOf(MIDFIELD_YARD) - logoW / 2);
  const y = Math.round(H / 2 - logoH / 2);

  ctx.save();
  ctx.globalAlpha = 0.9;
  ctx.drawImage(bflLogo, x, y, logoW, logoH);
  ctx.restore();
}

function drawEndzone(team, centerX, rotation) {
  if (!team) return;
  const { bg, text, outline } = TEAM_COLORS[team];

  ctx.fillStyle = bg;
  ctx.fillRect(centerX - (ENDZONE * P) / 2, 0, ENDZONE * P, H);

  ctx.save();
  ctx.translate(centerX, H / 2);
  ctx.rotate(rotation);

  ctx.font = "bold 40px Arial Black";
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  ctx.lineJoin = "round";
  ctx.lineWidth = 4;

  ctx.strokeStyle = outline;
  ctx.strokeText(getMascot(team), 0, 0);

  ctx.fillStyle = text;
  ctx.fillText(getMascot(team), 0, 0);

  ctx.restore();
}

function drawBoundaries() {
  ctx.strokeStyle = "white";
  ctx.lineWidth = 4;
  ctx.strokeRect(0, 0, W, H);

  ctx.beginPath();
  ctx.moveTo(xOf(PLAY_START), 0);
  ctx.lineTo(xOf(PLAY_START), H);
  ctx.moveTo(xOf(PLAY_END), 0);
  ctx.lineTo(xOf(PLAY_END), H);
  ctx.stroke();
}

function drawYardLines() {
  ctx.strokeStyle = "white";
  for (let y = PLAY_START; y <= PLAY_END; y += 5) {
    ctx.beginPath();
    ctx.lineWidth = ((y - PLAY_START) % 10 === 0) ? 2.5 : 1;
    ctx.moveTo(xOf(y), 0);
    ctx.lineTo(xOf(y), H);
    ctx.stroke();
  }
}

function drawHashMarks() {
  ctx.strokeStyle = "white";
  ctx.lineWidth = 1;
  const top = H * 0.32;
  const bot = H * 0.68;

  for (let y = PLAY_START + 1; y < PLAY_END; y++) {
    const x = xOf(y);
    ctx.beginPath();
    ctx.moveTo(x, top);
    ctx.lineTo(x, top + 6);
    ctx.moveTo(x, bot);
    ctx.lineTo(x, bot - 6);
    ctx.stroke();
  }
}

function drawNumbers() {
  ctx.fillStyle = "white";
  ctx.font = "26px Arial";
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";

  const topY = H * 0.18;
  const bottomY = H * 0.82;

  for (let n = 10; n <= 50; n += 10) {
    const leftX = xOf(PLAY_START + n);
    const rightX = xOf(PLAY_END - n);

    ctx.fillText(n, leftX, topY);
    ctx.fillText(n, rightX, topY);

    ctx.save();
    ctx.translate(leftX, bottomY);
    ctx.rotate(Math.PI);
    ctx.fillText(n, 0, 0);
    ctx.restore();

    ctx.save();
    ctx.translate(rightX, bottomY);
    ctx.rotate(Math.PI);
    ctx.fillText(n, 0, 0);
    ctx.restore();
  }
}

function drawFootball() {
  if (!footballImg.complete) return;
  ctx.drawImage(footballImg, xOf(ballYard) - 25, H / 2 - 27, 50, 55);
}

function drawFirstDownLine() {
  if (firstDownYard === null) return;

  ctx.save();
  ctx.strokeStyle = (down === 4) ? "#b0122a" : "#FFD400";
  ctx.lineWidth = 4;

  const x = xOf(firstDownYard);
  ctx.beginPath();
  ctx.moveTo(x, 0);
  ctx.lineTo(x, H);
  ctx.stroke();

  ctx.restore();
}

function drawLineOfScrimmage() {
  if (lineOfScrimmageYard === null) return;

  const x = xOf(lineOfScrimmageYard);

  ctx.strokeStyle = "#3b82f6";
  ctx.lineWidth = 3;

  ctx.beginPath();
  ctx.moveTo(x, 0);
  ctx.lineTo(x, H);
  ctx.stroke();
}

function resetFirstDown() {
  down = 1;
  toGo = 10;
  lineOfScrimmageYard = ballYard;
  const goalLine = getGoalLineYard();

  if (possession === "team1") {
    firstDownYard = Math.min(ballYard + toGo, goalLine);
  } else {
    firstDownYard = Math.max(ballYard - toGo, goalLine);
  }

  recalculateDownAndDistance();
  requestRedraw();
}

function requestRedraw() {
  requestAnimationFrame(drawField);
}

/* Moving Possession UI glow back and forth */
function applyPossessionUI() {
  const team1El = document.querySelector(".team1");
  const team2El = document.querySelector(".team2");

  team1El.classList.remove("possession");
  team2El.classList.remove("possession");

  const activeTeamEl = possession === "team1" ? team1El : team2El;
  const teamName = possession === "team1" ? team1.value : team2.value;

  const colors = TEAM_COLORS[teamName];

  const glowColor =
  colors?.bg && colors.bg !== "#000000"
    ? colors.bg
    : colors?.text || "#ffffff";

activeTeamEl.style.setProperty("--team-glow", glowColor);

  activeTeamEl.classList.add("possession");
}

/* ===========================
   MASTER DRAW FUNCTION TO CREATE EVERYTHING
   =========================== */
function drawField() {
  drawBackground();
  drawEndzone(team1.value, xOf(ENDZONE / 2), -Math.PI / 2);
  drawEndzone(team2.value, xOf(PLAY_END + ENDZONE / 2), Math.PI / 2);
  drawBoundaries();
  drawYardLines();
  drawHashMarks();
  drawNumbers();
  drawMidfieldLogo();
  drawLineOfScrimmage();
  drawFirstDownLine();
  drawFootball();
  updateTeamLogo("team1");
  updateTeamLogo("team2");
}

/* ===========================
   key interactions
   =========================== */

Object.keys(TEAM_COLORS).forEach(t => {
  team1.add(new Option(t, t));
  team2.add(new Option(t, t));
});

team1.value = "Detroit Lions";
team2.value = "Minnesota Vikings";

applyPossessionUI();
drawField();

team1.onchange = team2.onchange = drawField;

document.addEventListener("keydown", (e) => {
  if (["ArrowLeft", "ArrowRight", "ArrowUp", "Space", "Enter"].includes(e.key)) {
    e.preventDefault();
  }

  const step = e.shiftKey ? 10 : 1;
  let didChange = false;

  if (e.key === "ArrowLeft") {
    ballYard = Math.max(0, ballYard - step);
    didChange = true;
  }

  if (e.key === "ArrowRight") {
    ballYard = Math.min(120, ballYard + step);
    didChange = true;
  }

  if (e.key === "ArrowUp") {
    resetFirstDown();
    return;
  }

  if (e.code === "Space") {
    down = down < 4 ? down + 1 : 1;
    lineOfScrimmageYard = ballYard;
    recalculateDownAndDistance();
    requestRedraw();
    return;
  }

  if (e.key === "Enter") {
    e.preventDefault();
    togglePossession();
    return;
  }

  if (e.key.toLowerCase() === "o") {
  rollOffenseDice();
  return;
}

if (e.key.toLowerCase() === "d") {
  rollDefenseDice();
  return;
}

  if (didChange) {
    recalculateDownAndDistance();
    requestRedraw();
  }
});

function tryInitialDraw() {
  if (footballImg.complete && bflLogo.complete) drawField();
}
footballImg.onload = tryInitialDraw;
bflLogo.onload = tryInitialDraw;

// ===========================
// POSSESSION LOGIC
// ===========================

/* Removed possessionTeam DOM element usage; keep function structure intact. */
function getActiveTeamName(teamKey) {
  const select = teamKey === "team1" ? team1 : team2;
  const option = select.options[select.selectedIndex];
  return option ? option.text : teamKey === "team1" ? "Team 1" : "Team 2";
}

function updatePossessionUI() {
  // Possession pill removed; only apply glow now.
  applyPossessionUI();
}

team1.addEventListener("change", updatePossessionUI);
team2.addEventListener("change", updatePossessionUI);

function togglePossession() {
  possession = possession === "team1" ? "team2" : "team1";
  updatePossessionUI();

  if (firstDownYard !== null) {
    firstDownYard =
      possession === "team1"
        ? ballYard + toGo
        : ballYard - toGo;
  }

  recalculateDownAndDistance();
  requestRedraw();
}

updatePossessionUI();
applyPossessionUI();

/* ===========================
   DICE LOGIC (ANIMATED)
   =========================== */

const dice = {
  offense: {
    black: [1,2,2,3,3,3],
    yellow: [0,1,2,3,4,5],
    white: [0,0,1,2,3,4]
  },
  defense: {
    green: [0,0,0,0,1,2],
    red: [1,1,1,2,2,3]
  }
};

function rollDie(faces) {
  return faces[Math.floor(Math.random() * faces.length)];
}

function animateDice(dieEls, faceArrays, resultCallback) {
  const intervals = [];
  const results = [];

  dieEls.forEach((el, i) => {
    const faces = faceArrays[i];

    el.parentElement.classList.add("rolling");

    const interval = setInterval(() => {
      const face = faces[Math.floor(Math.random() * faces.length)];
      el.textContent = face;
    }, 60 + Math.random() * 40);

    intervals.push(interval);

    const stopTime = 450 + Math.random() * 300;

    setTimeout(() => {
      clearInterval(interval);

      const final = rollDie(faces);
      el.textContent = final;
      results[i] = final;

      el.parentElement.classList.remove("rolling");
      el.parentElement.classList.add("settle");

      setTimeout(() => {
        el.parentElement.classList.remove("settle");
      }, 180);

      if (results.filter(v => v !== undefined).length === dieEls.length) {
        resultCallback(results);
      }
    }, stopTime);
  });
}

/* OFFENSE */
function rollOffenseDice() {
  const blackEl = document.getElementById("offBlack");
  const yellowEl = document.getElementById("offYellow");
  const whiteEl = document.getElementById("offWhite");

  animateDice(
    [blackEl, yellowEl, whiteEl],
    [dice.offense.black, dice.offense.yellow, dice.offense.white],
    ([b, y, w]) => {
      const total = (b * 10) + y + w;
      document.getElementById("offenseResult").textContent = total;
    }
  );
}

/* DEFENSE */
function rollDefenseDice() {
  const greenEl = document.getElementById("defGreen");
  const redEl = document.getElementById("defRed");

  animateDice(
    [greenEl, redEl],
    [dice.defense.green, dice.defense.red],
    ([g, r]) => {
      document.getElementById("defenseResult").textContent = g + r;
    }
  );
  }

    
</script>

</body>
</html>
